const registroProducto=document.querySelector("#registro_producto_mercado");function mostrarMensaje(t){t.preventDefault();validarCampos()&&Swal.fire({title:"Registrar Producto?",icon:"question",showCancelButton:"Cancelar",confirmButtonText:"Guardar"}).then(o=>{o.isConfirmed&&(Swal.fire("Guardado con exito!","","success"),registerProduct(t))})}function validarCampos(){return!!document.querySelector("#producto").value||(Swal.fire("Falta informaciÃ³n!","","error"),!1)}async function registerProduct(){try{const t=new FormData(registroProducto);t.append("producto",registroProducto[0].value.toLowerCase()),t.append("marca",registroProducto[1].value.toLowerCase()),t.append("cantidad",registroProducto[2].value),t.append("categoria",registroProducto[3].value.toLowerCase()),t.append("observacion",registroProducto[4].value.toLowerCase());const o="http://localhost:3000/API/registro-producto",e=await fetch(o,{method:"POST",body:t});await e.json()&&setTimeout(()=>{document.querySelector(".swal2-container").remove();document.querySelectorAll('input[type="text"], input[type="number"]').forEach((function(t){t.value=""}))},2e3)}catch(t){Swal.fire("Error!","","error")}}let productos;registroProducto&&registroProducto.addEventListener("submit",(function(t){mostrarMensaje(t)}));const listaSelect=document.querySelector("#option-list-select");function offLoader(){const t=document.querySelector(".loader-page");t&&t.remove()}async function obtenerProductos(){try{const t="http://localhost:3000/API/obtener-producto",o=await fetch(t),e=await o.json();e&&(offLoader(),productos=[...e],limpiarLista(),ordenarProductos(e))}catch(t){console.log(t)}}function ordenarProductos(t){t.sort((t,o)=>t.producto<o.producto?-1:t.producto>o.producto?1:t.producto===o.producto?0:void 0),mostrarListas(t)}function mostrarListas(t){const o=document.querySelector("#lista_articulos");t.forEach((function(t){const e=document.createElement("LI"),a=document.createElement("LI"),r=document.createElement("DIV"),c=document.createElement("DIV"),i=document.createElement("LABEL"),n=document.createElement("IMG"),d=document.createElement("INPUT"),l=document.createElement("DIV"),s=document.createElement("DIV"),u=document.createElement("DIV");e.classList.add("articulos"),r.classList.add("div-product"),c.classList.add("div-icono"),i.classList.add("label-producto"),n.classList.add("img-categoria"),l.classList.add("editar-producto"),s.classList.add("eliminar-producto"),u.classList.add("opciones"),i.textContent=t.producto,i.setAttribute("for",t.producto),n.src=`build/img/${t.producto}.webp`,n.onerror=function(t){imagenDefault(t)},d.setAttribute("type","checkbox"),d.setAttribute("name",t.producto),l.onclick=()=>{confirmarEdicion(t)},s.onclick=()=>{confirmarEliminar(t)},r.appendChild(d),r.appendChild(i),c.appendChild(n),e.appendChild(r),a.appendChild(c),u.appendChild(l),u.appendChild(s),o.appendChild(e),o.appendChild(a),o.appendChild(u)}))}function imagenDefault(t){t.target.src="build/img/default.webp"}function filtrar(){limpiarLista();let t=[];productos.forEach(o=>{(o.categoria===listaSelect.value||"todos"===listaSelect.value)&&t.push(o)}),ordenarProductos(t)}function limpiarLista(){const t=document.querySelector("#lista_articulos");if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}async function confirmarEdicion(t){const{value:o}=await Swal.fire({title:"Actualizar Producto",html:`<form id="updateForm" method="POST" class="updateForm"><label for="producto">Producto</label><input name="producto" id="swal-input1" class="swal2-input"><label for="marca">Marca</label><input name="marca" id="swal-input2" class="swal2-input"><label for="categoria">Categoria</label><input name="categoria" id="swal-input3" class="swal2-input"><input type="hidden" name="id" value=${t.id} ></form>`}),e=document.querySelector("#updateForm"),a=new FormData;if(a.append("producto",e[0].value.toLowerCase()),a.append("marca",e[1].value.toLowerCase()),a.append("categoria",e[2].value.toLowerCase()),a.append("id",e[3].value),o)try{Swal.fire({title:"Actualizar Producto?",icon:"question",showCancelButton:"Cancelar",confirmButtonText:"Guardar"}).then(t=>{t.isConfirmed&&finalizarEdicion(a)})}catch(t){console.log(t)}}async function finalizarEdicion(t){const o=await fetch("http://localhost:3000/API/editar-producto",{method:"POST",body:t});await o.json()&&(Swal.fire("Actualizado con exito!","","success"),limpiarLista(),obtenerProductos())}async function confirmarEliminar(t){try{Swal.fire({title:"Eliminar Producto?",icon:"question",showCancelButton:"Cancelar",confirmButtonText:"Eliminar"}).then(o=>{o.isConfirmed&&eliminar(t)})}catch(t){console.log(t)}}async function eliminar(t){const o=new FormData;o.append("id",t.id);try{const t="http://localhost:3000/API/eliminar-producto",e=await fetch(t,{method:"POST",body:o});await e.json()&&(Swal.fire("Producto eliminado!","","success"),limpiarLista(),obtenerProductos())}catch(t){console.log(t)}}listaSelect&&listaSelect.addEventListener("change",(function(){filtrar()})),document.addEventListener("DOMContentLoaded",(function(){listaSelect&&obtenerProductos()}));